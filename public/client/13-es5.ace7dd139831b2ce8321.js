function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var n=0,e=new Array(t.length);n<t.length;n++)e[n]=t[n];return e}}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,n,e){return n&&_defineProperties(t.prototype,n),e&&_defineProperties(t,e),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{cPR9:function(t,n,e){"use strict";e.r(n);var i,a=e("ofXK"),o=e("tyNb"),r=e("2Vo4"),c=e("nYR2"),s=e("3E0/"),l=e("0EQZ"),b=e("fXoL"),u=e("LRXf"),d=((i=function(){function t(n){_classCallCheck(this,t),this.http=n}return _createClass(t,[{key:"getAll",value:function(t){return this.http.get("notifications/".concat(t,"/subscriptions"))}},{key:"updateUserSubscriptions",value:function(t,n){return this.http.put("notifications/".concat(t,"/subscriptions"),{selections:n})}}]),t}()).\u0275fac=function(t){return new(t||i)(b.bc(u.a))},i.\u0275prov=b.Nb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),g=e("twBr"),f=e("i2dy"),p=e("N2vX"),h=e("3Pt+"),v=e("bTqV"),m=e("bSwM");function k(t,n){if(1&t){var e=b.Yb();b.Xb(0,"div",11),b.Xb(1,"div",12),b.Nc(2),b.Wb(),b.Xb(3,"mat-checkbox",13),b.fc("change",(function(t){b.Cc(e);var i=n.$implicit,a=b.jc(3);return t?a.toggleAllRowsFor(i):null})),b.Wb(),b.Wb()}if(2&t){var i=n.$implicit,a=b.jc(3);b.Db(2),b.Oc(i),b.Db(1),b.rc("checked",a.allRowsSelectedFor(i))("indeterminate",a.selections[i].hasValue()&&!a.allRowsSelectedFor(i))("disabled","browser"===i&&!a.supportsBrowserNotifications)}}function y(t,n){if(1&t&&(b.Vb(0),b.Lc(1,k,4,4,"div",10),b.Ub()),2&t){var e=b.jc(2);b.Db(1),b.rc("ngForOf",e.availableChannels)}}function w(t,n){if(1&t){var e=b.Yb();b.Xb(0,"div",11),b.Xb(1,"mat-checkbox",16),b.fc("click",(function(t){return b.Cc(e),t.stopPropagation()}))("change",(function(t){b.Cc(e);var i=n.$implicit,a=b.jc().$implicit,o=b.jc(2);return t?o.selections[i].toggle(a.notif_id):null})),b.Wb(),b.Wb()}if(2&t){var i=n.$implicit,a=b.jc().$implicit,o=b.jc(2);b.Db(1),b.rc("checked",o.selections[i].isSelected(a.notif_id))("disabled","browser"===i&&!o.supportsBrowserNotifications)}}function C(t,n){if(1&t&&(b.Xb(0,"div",14),b.Xb(1,"div",15),b.Nc(2),b.Wb(),b.Lc(3,w,2,2,"div",10),b.Wb()),2&t){var e=n.$implicit,i=n.last,a=b.jc(2);b.Hb("no-border",i),b.Db(2),b.Oc(e.name),b.Db(1),b.rc("ngForOf",a.availableChannels)}}function P(t,n){if(1&t&&(b.Xb(0,"div",5),b.Xb(1,"div",6),b.Xb(2,"div",7),b.Nc(3),b.Wb(),b.Lc(4,y,2,1,"ng-container",8),b.Wb(),b.Lc(5,C,4,4,"div",9),b.Wb()),2&t){var e=n.$implicit,i=n.first;b.Db(3),b.Oc(e.group_name),b.Db(1),b.rc("ngIf",i),b.Db(1),b.rc("ngForOf",e.subscriptions)}}var _,O,x=((_=function(){function t(n,e,i,a,o){_classCallCheck(this,t),this.route=n,this.api=e,this.currentUser=i,this.toast=a,this.cd=o,this.loading$=new r.a(!1),this.supportsBrowserNotifications="Notification"in window,this.availableChannels=[],this.selections={},this.allNotifIds=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe((function(n){t.subscriptions=n.api.subscriptions,t.availableChannels=n.api.available_channels,t.allNotifIds=n.api.all_notif_ids,t.availableChannels.forEach((function(e){t.selections[e]=new l.c(!0,n.api.selections[e])}))})),"granted"!==Notification.permission&&this.bindToBrowserNotifSubscription()}},{key:"toggleAllRowsFor",value:function(t){var n;this.allRowsSelectedFor(t)?this.selections[t].clear():(n=this.selections[t]).select.apply(n,_toConsumableArray(this.allNotifIds))}},{key:"allRowsSelectedFor",value:function(t){return this.selections[t].selected.length===this.allNotifIds.length}},{key:"saveSettings",value:function(){var t=this;this.loading$.next(!0);var n=this.getPayload();this.api.updateUserSubscriptions(this.currentUser.get("id"),n).pipe(Object(c.a)((function(){return t.loading$.next(!1)}))).subscribe((function(){t.toast.open("Notification settings updated.")}))}},{key:"getPayload",value:function(){var t=this,n={};return Object.keys(this.selections).forEach((function(e){n[e]=t.selections[e].selected})),n}},{key:"bindToBrowserNotifSubscription",value:function(){var t=this;this.selections.browser.changed.pipe(Object(s.a)(1)).subscribe((function(n){n.added.length&&!n.removed.length&&("denied"===Notification.permission?(t.toast.open("Notifications blocked. Please enable them for this site from browser settings."),t.selections.browser.clear(),t.cd.markForCheck()):Notification.requestPermission().then((function(n){"granted"!==n&&(t.selections.browser.clear(),t.cd.markForCheck())})))}))}}]),t}()).\u0275fac=function(t){return new(t||_)(b.Rb(o.a),b.Rb(d),b.Rb(g.a),b.Rb(f.a),b.Rb(b.h))},_.\u0275cmp=b.Lb({type:_,selectors:[["notification-subscriptions"]],decls:7,vars:4,consts:[["menuPosition","agent-mailbox",1,"box-shadow"],[1,"be-container"],[1,"table","material-panel",3,"ngSubmit"],["class","setting-group",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"setting-group"],[1,"row"],["trans","",1,"name-column","strong"],[4,"ngIf"],["class","row indent",3,"no-border",4,"ngFor","ngForOf"],["class","channel-column",4,"ngFor","ngForOf"],[1,"channel-column"],["trans","",1,"channel-name"],[3,"checked","indeterminate","disabled","change"],[1,"row","indent"],["trans","",1,"name-column"],[3,"checked","disabled","click","change"]],template:function(t,n){1&t&&(b.Sb(0,"material-navbar",0),b.Xb(1,"div",1),b.Xb(2,"form",2),b.fc("ngSubmit",(function(t){return n.saveSettings()})),b.Lc(3,P,6,3,"div",3),b.Xb(4,"button",4),b.kc(5,"async"),b.Nc(6,"Save Settings"),b.Wb(),b.Wb(),b.Wb()),2&t&&(b.Db(3),b.rc("ngForOf",n.subscriptions),b.Db(1),b.rc("disabled",b.lc(5,2,n.loading$)))},directives:[p.a,h.J,h.u,h.v,a.s,v.b,a.t,m.a],pipes:[a.b],styles:["[_nghost-%COMP%]{display:block;background-color:var(--be-background-alternative);min-height:100vh}.be-container[_ngcontent-%COMP%]{padding-top:35px;padding-bottom:35px}.table[_ngcontent-%COMP%]{border-radius:4px}.setting-group[_ngcontent-%COMP%]{margin-bottom:10px}.row[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;border-bottom:1px solid var(--be-divider-default);padding:10px}.row.no-border[_ngcontent-%COMP%]{border-bottom:none}.row.indent[_ngcontent-%COMP%]{padding-left:20px}.name-column[_ngcontent-%COMP%]{-webkit-box-flex:1;flex:1 1 auto}.strong[_ngcontent-%COMP%]{font-weight:500;font-size:1.5rem;align-self:flex-end}.channel-name[_ngcontent-%COMP%]{margin-bottom:10px}.channel-column[_ngcontent-%COMP%]{width:75px;text-align:center;text-transform:capitalize}.submit-button[_ngcontent-%COMP%]{margin-top:15px}"],changeDetection:0}),_),N=e("JIr8"),W=e("5+tZ"),X=e("EY2u"),j=e("LRne"),M=((O=function(){function t(n,e,i){_classCallCheck(this,t),this.router=n,this.subscriptions=e,this.currentUser=i}return _createClass(t,[{key:"resolve",value:function(t,n){var e=this;return this.subscriptions.getAll(+this.currentUser.get("id")).pipe(Object(N.a)((function(){return e.router.navigate(["/account/settings"]),X.a})),Object(W.a)((function(t){return t?Object(j.a)(t):(e.router.navigate(["/account/settings"]),X.a)})))}}]),t}()).\u0275fac=function(t){return new(t||O)(b.bc(o.f),b.bc(d),b.bc(g.a))},O.\u0275prov=b.Nb({token:O,factory:O.\u0275fac,providedIn:"root"}),O),R=e("kmQS"),S=e("f+iI"),D=e("OnlV"),F=e("WWJw"),$=e("Rd8u");function A(t,n){if(1&t){var e=b.Yb();b.Xb(0,"li"),b.Xb(1,"button",4),b.fc("click",(function(t){b.Cc(e);var i=n.$implicit;return b.jc().selectPage(i)})),b.Nc(2),b.Wb(),b.Wb()}if(2&t){var i=n.$implicit,a=b.jc();b.Db(1),b.Hb("active",a.currentPage===i),b.rc("disabled",a.disabled),b.Db(1),b.Oc(i)}}var I,L,T,U,B=((I=function(){function t(n){_classCallCheck(this,t),this.router=n,this.pageChanged=new b.o,this.disabled=!0}return _createClass(t,[{key:"selectPage",value:function(t){this.currentPage!==t&&(this.currentPage=t,this.pageChanged.next(t),this.router.navigate([],{queryParams:{page:t},replaceUrl:!0}))}},{key:"nextPage",value:function(){var t=this.currentPage+1;this.selectPage(t<=this.numberOfPages?t:this.currentPage)}},{key:"prevPage",value:function(){var t=this.currentPage-1;this.selectPage(t>=1?t:this.currentPage)}},{key:"shouldHide",get:function(){return this.numberOfPages<2}},{key:"pagination",set:function(t){t&&(this.numberOfPages=t.last_page>10?10:t.last_page,this.iterator=Array.from(Array(this.numberOfPages-1).keys()).map((function(t){return t+1})),this.currentPage=t.current_page)}}]),t}()).\u0275fac=function(t){return new(t||I)(b.Rb(o.f))},I.\u0275cmp=b.Lb({type:I,selectors:[["pagination-widget"]],hostVars:2,hostBindings:function(t,n){2&t&&b.Hb("hidden",n.shouldHide)},inputs:{disabled:"disabled",pagination:"pagination"},outputs:{pageChanged:"pageChanged"},decls:8,vars:3,consts:[[1,"page-numbers"],["type","button","mat-button","","trans","",1,"prev",3,"disabled","click"],[4,"ngFor","ngForOf"],["type","button","mat-button","","trans","",1,"next",3,"disabled","click"],["type","button","mat-flat-button","","color","gray",1,"page-number-button",3,"disabled","click"]],template:function(t,n){1&t&&(b.Xb(0,"ul",0),b.Xb(1,"li"),b.Xb(2,"button",1),b.fc("click",(function(t){return n.prevPage()})),b.Nc(3,"Previous"),b.Wb(),b.Wb(),b.Lc(4,A,3,4,"li",2),b.Xb(5,"li"),b.Xb(6,"button",3),b.fc("click",(function(t){return n.nextPage()})),b.Nc(7,"Next"),b.Wb(),b.Wb(),b.Wb()),2&t&&(b.Db(2),b.rc("disabled",n.disabled),b.Db(2),b.rc("ngForOf",n.iterator),b.Db(2),b.rc("disabled",n.disabled))},directives:[v.b,$.a,a.s],styles:["[_nghost-%COMP%]{display:block}ul[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;flex-wrap:wrap;width:100%}.page-number-button[_ngcontent-%COMP%]{width:40px;height:40px;min-width:40px;line-height:40px;padding:0;margin:0 3px 6px}.active[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.next[_ngcontent-%COMP%], .prev[_ngcontent-%COMP%]{color:var(--be-accent-default)}"],changeDetection:0}),I),E=[{path:"",component:(L=function(){function t(n,e,i,a){_classCallCheck(this,t),this.settings=n,this.notifications=e,this.breakpoints=i,this.route=a,this.pagination$=new r.a(null)}return _createClass(t,[{key:"ngOnInit",value:function(){this.loadPage(this.route.snapshot.queryParams.page||1)}},{key:"loadPage",value:function(t){var n=this;this.notifications.load({page:t,perPage:25}).subscribe((function(t){n.pagination$.next(t.pagination)}))}},{key:"markAsRead",value:function(t){this.pagination$.value.data.find((function(n){return n.id===t.id})).read_at=t.read_at}}]),t}(),L.\u0275fac=function(t){return new(t||L)(b.Rb(R.a),b.Rb(S.a),b.Rb(D.a),b.Rb(o.a))},L.\u0275cmp=b.Lb({type:L,selectors:[["notification-page"]],decls:8,vars:13,consts:[[3,"menuPosition"],[1,"be-container"],[3,"notifications","compact","markedAsRead"],[3,"pagination","disabled","pageChanged"]],template:function(t,n){if(1&t&&(b.Sb(0,"material-navbar",0),b.Xb(1,"div",1),b.Xb(2,"notification-list",2),b.fc("markedAsRead",(function(t){return n.markAsRead(t)})),b.kc(3,"async"),b.kc(4,"async"),b.Wb(),b.Xb(5,"pagination-widget",3),b.fc("pageChanged",(function(t){return n.loadPage(t)})),b.kc(6,"async"),b.kc(7,"async"),b.Wb(),b.Wb()),2&t){var e,i=null==(e=b.lc(3,5,n.pagination$))?null:e.data;b.rc("menuPosition",n.settings.get("vebto.navbar.defaultPosition")),b.Db(2),b.rc("notifications",i)("compact",b.lc(4,7,n.breakpoints.isMobile$)),b.Db(3),b.rc("pagination",b.lc(6,9,n.pagination$))("disabled",b.lc(7,11,n.notifications.loading$))}},directives:[p.a,F.a,B],pipes:[a.b],styles:["[_nghost-%COMP%]{display:block;min-height:100vh;background-color:var(--be-background-alternative)}.be-container[_ngcontent-%COMP%]{padding-top:25px;padding-bottom:25px}pagination-widget[_ngcontent-%COMP%]{margin-top:35px}"],changeDetection:0}),L)},{path:"settings",component:x,resolve:{api:M}}],H=((T=function t(){_classCallCheck(this,t)}).\u0275mod=b.Pb({type:T}),T.\u0275inj=b.Ob({factory:function(t){return new(t||T)},imports:[[o.j.forChild(E)],o.j]}),T),V=e("MKyN"),J=e("CXWK"),Y=e("gFpt"),q=e("6rvT"),K=((U=function t(){_classCallCheck(this,t)}).\u0275mod=b.Pb({type:U}),U.\u0275inj=b.Ob({factory:function(t){return new(t||U)},imports:[[a.c,v.c,q.a]]}),U);e.d(n,"NotificationsModule",(function(){return Q}));var z,Q=((z=function t(){_classCallCheck(this,t)}).\u0275mod=b.Pb({type:z}),z.\u0275inj=b.Ob({factory:function(t){return new(t||z)},imports:[[a.c,h.n,h.D,H,Y.a,V.a,J.a,K,m.b,v.c]]}),z)}}]);
//# sourceMappingURL=13-es5.ace7dd139831b2ce8321.js.map